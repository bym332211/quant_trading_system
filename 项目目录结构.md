# 量化交易系统 - 项目目录结构
 
## 项目概览

这是一个基于Python的量化交易系统，集成了数据处理、机器学习模型、回测引擎和交易策略等核心功能。

## 目录结构 

```
quant_trading_system/
├── .gitignore                          # Git忽略文件配置
├── README.md                           # 项目说明文档
├── Advise.md                          # 项目建议和指导
├── CMD.md                             # 命令行使用说明
├── artifacts/                         # 构建产物和部署文件
├── backtest/                          # 回测系统
│   └── engine/
│       └── run_backtest.py           # 回测执行引擎
├── config/                            # 配置管理
│   └── config.yaml                   # 主配置文件
├── data/                              # 数据处理模块
│   ├── build_factors.py              # 因子构建脚本
│   ├── build_qlib_us.py              # Qlib美股数据构建
│   ├── download_sp500.py             # S&P500数据下载
│   ├── make_instrument_sector.py     # 股票行业分类处理
│   ├── make_instrument_shares.py     # 股票份额数据处理
│   ├── make_sp500_list.py            # S&P500股票列表生成
│   ├── verify_adjusted_qlib.py       # Qlib数据验证
│   └── data/                         # 原始数据存储目录
├── models/                            # 机器学习模型
│   └── lgbm/                         # LightGBM模型实现
│       ├── dataset.py                # 数据集处理
│       ├── evaluate.py               # 模型评估
│       ├── inference.py              # 模型推理
│       ├── test.py                   # 模型测试
│       └── train.py                  # 模型训练
├── scripts/                          # 工具脚本
│   ├── dump_bin.py                   # 二进制数据导出
│   ├── rebuild_us_1day.sh            # 美股日线数据重建
│   ├── rebuild_us_1min.sh            # 美股分钟数据重建
│   └── rebuild_us_5min.sh            # 美股5分钟数据重建
├── strategies/                       # 交易策略
│   └── lgbm_weekly/                  # 基于LightGBM的周策略
│       └── predict.py                # 策略预测模块
└── utils/                            # 通用工具函数
```

```
quant_trading_system/
├── cli/
│   └── run.py                              # 统一CLI入口（参数与v3兼容）
├── backtest/
│   ├── framework/
│   │   ├── __init__.py
│   │   ├── engine.py                       # ① 纯回测框架：装配BT、执行权重闭包
│   │   ├── interfaces.py                   # 通用协议：Selection/Entry/Exit/Risk/Position/KPI
│   │   ├── utils_data.py                   # 数据&日历：Qlib加载、周频锚定、as-of映射
│   │   └── utils_math.py                   # 中性化/ICDF/Water-filling/%ADV限速等
│   ├── strategies/                         # ② 策略（选股/入场/出场，可多空分参）
│   │   ├── __init__.py
│   │   ├── base.py                         # LongShortParams/LegParams & 基类
│   │   ├── selection/
│   │   │   ├── __init__.py
│   │   │   └── lgbm_weekly.py              # 2.1 选股：rank/score + buffer
│   │   ├── entry/
│   │   │   ├── __init__.py
│   │   │   └── equal_icdf.py               # 2.2 入场：equal/icdf + 短腿择时
│   │   └── exit/
│   │       ├── __init__.py
│   │       └── keep_buffer.py              # 2.3 出场：缓冲/占位（可扩展止损止盈/时间退出）
│   ├── risk/
│   │   ├── __init__.py
│   │   ├── pipeline.py                     # ③ 风控流水线：中性化→平滑→目标波动→硬上限→%ADV
│   │   └── rules.py                        # 可选：单条规则拆分（如行业预算/TE约束）
│   ├── position/
│   │   ├── __init__.py
│   │   └── sizing.py                       # ④ 仓位管理：兜底最小权重/整数股等
│   └── kpi/
│       ├── __init__.py
│       └── report.py                       # ⑤ KPI汇总与导出（Sharpe/CAGR/MDD/曲线等）
│
├── backtest_v3/                            # （可选）旧版保留便于对照
│   └── run_backtest.py
│
├── data/                                   # 现有数据模块（保持不变）
├── models/                                 # LGBM等（保持不变）
├── scripts/                                # 重建脚本（保持不变）
├── config/
│   └── config.yaml                         # 全局参数（可选）
├── artifacts/                              # features/preds等产物
└── tests/                                   # 单测骨架
    ├── test_framework_engine.py
    ├── test_strategies_selection_entry_exit.py
    ├── test_risk_pipeline.py
    ├── test_position_sizing.py
    └── test_kpi_report.py

```

## 模块功能说明

### 📊 数据处理 (data/)
- **数据获取**: 自动下载S&P500成分股数据
- **数据预处理**: 构建技术指标和因子
- **数据验证**: 确保数据质量和完整性
- **格式转换**: 支持Qlib数据格式

### 🤖 机器学习模型 (models/)
- **LightGBM模型**: 基于梯度提升的预测模型
- **完整流程**: 数据集构建、训练、评估、推理
- **模型管理**: 支持模型保存和加载

### 📈 交易策略 (strategies/)
- **策略框架**: 可扩展的策略架构
- **信号生成**: 基于机器学习的交易信号
- **风险管理**: 内置风险控制机制

### 🔄 回测系统 (backtest/)
- **历史回测**: 完整的策略历史表现分析
- **性能指标**: 收益率、夏普比率、最大回撤等
- **可视化**: 交易结果图表展示

### ⚙️ 配置管理 (config/)
- **统一配置**: YAML格式的配置文件
- **环境隔离**: 支持开发、测试、生产环境
- **参数调优**: 便于策略参数优化

### 🛠️ 工具脚本 (scripts/)
- **数据重建**: 自动化数据处理流程
- **批处理**: 支持批量数据操作
- **系统维护**: 数据库清理和优化

## 技术栈

- **编程语言**: Python
- **机器学习**: LightGBM
- **数据处理**: Pandas, NumPy
- **量化框架**: Qlib
- **数据源**: S&P500成分股

## 使用说明

1. **环境准备**: 安装依赖包和配置环境
2. **数据获取**: 运行data/目录下的脚本获取数据
3. **模型训练**: 使用models/lgbm/train.py训练模型
4. **策略回测**: 通过backtest/engine/run_backtest.py执行回测
5. **实盘交易**: 使用strategies/模块进行实时交易

## 项目特点

- ✅ **模块化设计**: 清晰的代码结构和职责分离
- ✅ **可扩展性**: 支持添加新的模型和策略
- ✅ **自动化**: 完整的数据处理和模型训练流程
- ✅ **可配置**: 灵活的参数配置和环境管理
- ✅ **专业性**: 基于成熟的量化交易框架

---

*注：本文档不包含CSV数据文件和reports报告目录的详细内容*
